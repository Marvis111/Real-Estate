     <div class="new-user">
                
            </div>
            <div class="welcome-img">
                <img src="/images/msls/Online Review-pana.png" />
            </div>
            .new-user{
    width: 100%;
    height: auto;
    text-align: center;
    padding: 10px;
    margin-top: 20px;
}
.new-user h4{
    font-size: 22px;
    font-weight: bold;
    text-transform: uppercase;
    margin-bottom: 10px;
}

.welcome-img{
    width: auto;
    background: white;
    border-radius: 50%;
    margin-top: 10px;
}
.welcome-img img,
module.exports = ()=>{
        console.log(process.env.NODE_ENV)
        if (process.env.NODE_ENV ) {
                
        }
}


app.use((req,res,next)=>{
        res.locals.flashMessages = req.flash();
        if (req.session.cookie.maxAge > Date.now() ) {
                req.session.userId = req.cookies.userId;
                req.session.fname = req.cookies.fname;
                req.session.lname = req.cookies.lname;
                req.session.email = req.cookies.email;
                next();
        }
        next();
        
})

app.use((req,res,next)=>{
        if (req.session !== null) {
                const {lname,fname,userId,email} = req.session
                res.locals.user = {lname,fname,userId,email}
                 next()
        }else{
                res.locals.user = null
                next()
        }
});
//



const {check,validationResult,sanitizeBody, body} = require("express-validator"),
{User} = require('../model/database'),
bcrypt = require('bcrypt')
//jwt = require('jsonwebtoken')

module.exports = {
    checkInput:[
        sanitizeBody('email').normalizeEmail({all_lowercase:true,}),
        check('fname','First name is required').notEmpty(),
        check('lname','Last name is required').notEmpty(),
        check('email','Email Address is required').isEmail(),
        check('password','Password is required').notEmpty(),
    ],
    validateInputs:async(req,res,next)=>{
        console.log(req.body);
        //dont skip the next middle war
        req.skip = false
        const {errors} = validationResult(req);
        //console.log(errors)
        if (errors.length > 0) {
            req.skip = true;
            req.statusCode = 400;
             req.flash('errors',errors);
             res.locals.redirect = '/signup';
             next();
        } else {
            if (req.body.password === req.body.comf_password ) {
               try {
                const hashedPasword = await bcrypt.hash(req.body.password,10);
                const newUser = await User.create({...req.body,password:hashedPasword});
                //set up cookie...
                res.cookie('userId',newUser._id,{
                    //expire.. in one hour
                    expires:new Date(Date.now() + 1000 * 60 * 60 )
                });
                res.cookie('fname',newUser.fname,{
                    //expire.. in one hour
                    expires:new Date(Date.now() + 1000 * 60 * 60 ),
                    signed:true
                });
                res.cookie('lname',newUser.lname,{
                    //expire.. in one hour
                    expires:new Date(Date.now() + 1000 * 60 * 60 )
                });
                res.cookie('email',newUser.email,{
                    //expire.. in one hour
                    expires:new Date(Date.now() + 1000 * 60 * 60 )
                });
                //session
                req.session.userId = newUser._id;
                req.session.fname = newUser.fname;
                req.session.lname = newUser.lname;
                req.session.email = newUser.email;
                //
                const {lname,_id , email,fname} = newUser
                req.flash('success',{message:`Welcome ${fname}, you are ready to make Purchase`});
                req.statusCode = 200;
                res.locals.user = {lname,userId:_id,fname,email}
                res.locals.redirect = '/';
                next();
               } catch (error) {
                   console.log(error)
                   req.skip = true;
                   if (error.code === 11000) {
                    req.flash('errors',[{msg:"Email Address Already Exist."}]);
                   }else{
                    req.flash('errors',[{msg:error.message}]);
                   }
                   res.locals.redirect = '/signup';
                   next();
               }
            } else {
                 //skip the next middle ware..
                 req.skip = true;
                 req.flash('errors',[{msg:"Password mismatched"}]);
                 res.locals.redirect = '/signup';
                 next();
            }
        }

    },
    saveValidUser:async (req,res,next) =>{
       if(req.skip){
            next();
       }else{
//
       }
    },
    redirectView: (req,res,next)=>{
        let redirectView = res.locals.redirect;
        if(redirectView){
            res.redirect(redirectView);
        }
        next();
    }
    
}


    
        const signupForm = document.getElementById('signupForm');
        signupForm.onsubmit = (e) =>{
            e.preventDefault();
            const formData = new FormData( document.getElementById(e.target.id) );
            $.ajax({
                url:"/signup",
                method:"POST",
                data: formData,
                processData:false,
                contentType:false,
                success:(data) =>{
                    console.log(data);
                }
            })
        }